<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OneHub's Blog</title>
    <!-- Bootstrap CSS -->
    <link href="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/bootstrap/5.1.3/css/bootstrap.min.css" type="text/css" rel="stylesheet" />
    <!-- Bootstrap Icons -->
    <link href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/bootstrap-icons/1.8.1/font/bootstrap-icons.css" type="text/css" rel="stylesheet" />
    <!-- Highlight.js CSS -->
    <link href="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/highlight.js/11.4.0/styles/github.min.css" type="text/css" rel="stylesheet" />
    <style>
        /* 自定义样式 */
        .blog-card {
            cursor: pointer;
            transition: transform 0.3s;
            height: 100%;
        }
        .blog-card:hover {
            transform: translateY(-5px);
        }
        .card-img-top {
            height: 180px;
            object-fit: cover;
        }
        .modal-body img {
            max-width: 100%;
            height: auto;
        }
        pre {
            padding: 15px !important;
            border-radius: 5px;
        }
        code {
            padding: 2px 4px;
            border-radius: 3px;
        }
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 20px;
        }
        .loading-spinner i {
            font-size: 2rem;
            color: #0d6efd;
        }
        .search-box {
            max-width: 300px;
        }
        .lazy-load {
            background-color: #f8f9fa;
            min-height: 180px;
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#">OneHub's Blog</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0"></ul>
                <div class="d-flex">
                    <input class="form-control me-2 search-box" type="search" placeholder="搜索文章..." id="searchInput">
                </div>
            </div>
        </div>
    </nav>

    <!-- 博客列表容器 -->
    <div class="container my-5">
        <div class="row g-4" id="blogContainer"></div>
        <div class="loading-spinner" id="loadingSpinner">
            <i class="bi bi-arrow-repeat"></i>
            <p>加载中...</p>
        </div>
    </div>

    <!-- 模态框 -->
    <div class="modal fade" id="blogModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static">
        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="blogModalTitle"></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="blogModalContent"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 页脚 -->
    <footer class="bg-light py-4 mt-5">
        <div class="container text-center">
            <p>博客内容托管于 <a href="https://github.com/" target="_blank">GitHub</a></p>
            <p>&copy; 2019 - 2025 liuxiaolong01.github.io | 基于Bootstrap构建</p>
        </div>
    </footer>

    <!-- JavaScript 库 -->
    <script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/bootstrap/5.1.3/js/bootstrap.bundle.min.js" type="application/javascript"></script>
    <script src="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/marked/4.0.2/marked.js" type="application/javascript"></script>
    <script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/highlight.js/11.4.0/highlight.min.js" type="application/javascript"></script>

    <script>
        // 配置变量
        const GITHUB_API = 'https://api.github.com/repos/liuxiaolong01/liuxiaolong01.github.io/contents/blog?ref=gh-pages';
        const COVER_IMAGE_API = 'https://api.imlcd.cn/bg/gq.php';
        
        // 初始化变量
        let allBlogs = [];
        let isLoading = false;
        let page = 1;
        const perPage = 6;
        
        // 页面加载完成后执行
        $(document).ready(function() {
            // 加载博客列表
            loadBlogs();
            
            // 设置滚动加载
            $(window).scroll(function() {
                if ($(window).scrollTop() + $(window).height() > $(document).height() - 200) {
                    if (!isLoading && allBlogs.length > 0) {
                        loadMoreBlogs();
                    }
                }
            });
            
            // 搜索功能
            $('#searchInput').on('keyup', function(e) {
                if (e.key === 'Enter') {
                    const searchTerm = $(this).val().toLowerCase();
                    filterBlogs(searchTerm);
                }
            });
        });
        
        // 加载博客列表
        function loadBlogs() {
            isLoading = true;
            $('#loadingSpinner').show();
            
            $.ajax({
                url: GITHUB_API,
                method: 'GET',
                dataType: 'json',
                success: function(data) {
                    if (Array.isArray(data)) {
                        // 过滤出.md文件
                        allBlogs = data.filter(item => item.name.endsWith('.md'));
                        renderBlogs();
                    } else {
                        console.error('Invalid data format received from GitHub API');
                    }
                },
                error: function(xhr, status, error) {
                    console.error('Error fetching blogs:', error);
                    $('#loadingSpinner').html('<p class="text-danger">加载失败，请刷新重试</p>');
                },
                complete: function() {
                    isLoading = false;
                    $('#loadingSpinner').hide();
                }
            });
        }
        
        // 渲染博客列表
        function renderBlogs(filteredBlogs = null) {
            const blogsToRender = filteredBlogs || allBlogs.slice(0, page * perPage);
            const $blogContainer = $('#blogContainer');
            
            if (filteredBlogs) {
                $blogContainer.empty();
                page = 1;
            }
            
            blogsToRender.forEach((blog, index) => {
                const blogCard = `
                    <div class="col-md-4 col-sm-6">
                        <div class="card blog-card mb-4" data-index="${index}">
                            <img src="${COVER_IMAGE_API}?random=${index}" class="card-img-top lazy-load" alt="封面图" loading="lazy">
                            <div class="card-body">
                                <h5 class="card-title">${blog.name.replace('.md', '')}</h5>
                            </div>
                        </div>
                    </div>
                `;
                
                if (filteredBlogs || index >= (page - 1) * perPage) {
                    $blogContainer.append(blogCard);
                }
            });
            
            // 延迟加载图片
            $('img.lazy-load').each(function() {
                const $img = $(this);
                const src = $img.attr('src');
                $img.removeClass('lazy-load');
                $img.attr('src', src);
            });
            
            // 绑定点击事件
            $('.blog-card').off('click').on('click', function() {
                const index = $(this).data('index');
                const blog = filteredBlogs ? filteredBlogs[index] : allBlogs[index];
                showBlogContent(blog);
            });
        }
        
        // 加载更多博客
        function loadMoreBlogs() {
            if (page * perPage >= allBlogs.length) return;
            
            isLoading = true;
            page++;
            renderBlogs();
            isLoading = false;
        }
        
        // 显示博客内容
        function showBlogContent(blog) {
            $('#blogModalTitle').text(blog.name.replace('.md', ''));
            $('#blogModalContent').html('<div class="text-center"><i class="bi bi-arrow-repeat"></i> 加载中...</div>');
            
            const modal = new bootstrap.Modal(document.getElementById('blogModal'));
            modal.show();
            
            // 获取原始Markdown内容
            $.ajax({
                url: blog.download_url,
                method: 'GET',
                dataType: 'text',
                success: function(markdown) {
                    // 使用marked.js转换为HTML
                    const html = marked.parse(markdown);
                    $('#blogModalContent').html(html);
                    
                    // 高亮代码块
                    $('pre code').each(function(i, block) {
                        hljs.highlightElement(block);
                    });
                },
                error: function(xhr, status, error) {
                    console.error('Error fetching blog content:', error);
                    $('#blogModalContent').html('<p class="text-danger">加载失败，请刷新重试</p>');
                }
            });
        }
        
        // 过滤博客
        function filterBlogs(searchTerm) {
            if (!searchTerm) {
                renderBlogs();
                return;
            }
            
            const filteredBlogs = allBlogs.filter(blog => 
                blog.name.toLowerCase().includes(searchTerm)
            );
            
            renderBlogs(filteredBlogs);
        }
    </script>
</body>
</html>